// Parameters for every process in main.nf
process {

    executor = 'slurm'

    queue = 'burst'
    clusterOptions = '-A bsd --qos=default --nodes=1 --constraint=high_mem_cd'

    withLabel: small {
        cpus = 1
        memory = '8 GB'
        time = '2h'
    }

    withLabel: large {
        cpus = 32
        memory = '48 GB'
        time = '24h'
    }

    // Use .sif file if provided, otherwise fall back to docker URI
    container = params.container_sif ?: "garciasarah2099/diannpipeline:${params.diann_version}"

}

// For Container Use
apptainer {
    enabled    = true
    autoMounts = true
    // Always use the shared cache directory for .sif files
    cacheDir   = '/lustre/or-scratch/cades-bsd/jkg/cache'
    pullTimeout = '60m'
}

// Environment variables - use job-specific paths when provided
env {
    NXF_HOME = '/lustre/or-scratch/cades-bsd/jkg/work/.nextflow'
    APPTAINERENV_NXF_TASK_WORKDIR = '/lustre/or-scratch/cades-bsd/jkg/work'
    APPTAINERENV_TMPDIR = '/lustre/or-scratch/cades-bsd/jkg/tmp'
}

// Defining parameters - these can be overridden via command line
params.raw_dir = '/lustre/or-scratch/cades-bsd/jkg/rawfiles'
params.fasta_dir = '/lustre/or-scratch/cades-bsd/jkg/fasta'
params.config_dir = '/lustre/or-scratch/cades-bsd/jkg/configs'
workDir = '/lustre/or-scratch/cades-bsd/jkg/work'
params.outdir  = '/lustre/or-scratch/cades-bsd/jkg/results'
params.container_sif = null  // Path to pre-pulled .sif file
params.diann_version = '2.3.1'  // Default DIANN version

// Report files
trace {
    enabled = true
    file = "logs/trace.txt"
}

report {
    enabled = true
    file = "logs/report.html"
}

timeline {
    enabled = true
    file = "logs/timeline.html"
}

dag {
    enabled = true
    file = "logs/dag.html"
}
